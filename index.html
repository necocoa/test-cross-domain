<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>GitHub 予約ページ</title>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-BS613Z33ZT"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-BS613Z33ZT");
    </script>
  </head>
</html>
<body>
  <div>Page</div>
  <iframe
    id="CoubicWidgetCalendar"
    src="https://coubic.com/rsv-nat-dev/widget/calendar"
    width="100%"
    height="600"
    style="border: none"
  ></iframe>

  <!-- クロスドメイン用 セッション引き継ぎ -->
  <script>
    var getGaClientId = new Promise(function (resolve) {
      gtag("get", "G-BS613Z33ZT", "client_id", resolve);
    });
    var getGaSessionId = new Promise(function (resolve) {
      gtag("get", "G-BS613Z33ZT", "session_id", resolve);
    });

    Promise.all([getGaClientId, getGaSessionId]).then(function (ids) {
      var clientId = ids[0];
      var sessionId = ids[1];

      var iframe = document.querySelector("#CoubicWidgetCalendar");
      if (iframe) {
        var src = iframe.src;
        var url = document.createElement("a");
        url.href = src;

        var searchParams = url.search ? url.search.substring(1) : "";
        var params = new URLSearchParams(searchParams);

        params.append("ga_client_id", clientId);
        params.append("ga_session_id", sessionId);

        url.search = params.toString();
        iframe.src = url.href;
      }
    });

    gtag("event", "screen_view", {
      app_name: "myAppName",
      screen_name: "Home",
    });
  </script>
</body>
